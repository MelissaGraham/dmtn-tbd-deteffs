\documentclass[DM,lsstdraft,toc]{lsstdoc}
\usepackage{graphicx}
\usepackage{url}
\usepackage{latexsym}
\usepackage{color}
% black, blue, brown, cyan, darkgray, gray, green, lightgray, lime, magenta, blue, orange, pink, purple, red, teal, violet, white, yellow.
\usepackage{enumitem}
\usepackage{esvect}

\title[Detection Efficiencies]{Characterizing {\tt DIASource} Detection Efficiency}

\author{M.~L.~Graham et al., and the DM SST}

\setDocRef{DMTN-TBD}
\date{\today}
\setDocUpstreamLocation{\url{https://github.com/lsst-dm/dmtn-tbd}}


% % % % % % % % % % % % % % % % % %
\setDocAbstract{The goals of this study are to: (1) validate that the planned DM data products which characterize {\tt DIASource} detectability will meet the scientific needs of the community; (2) ensure that the requirements related to the characterization of {\tt DIASource} detectability are adequately flowed down, and that DM's plans are accurately expressed in the DM documentation; and (3) inform the community about the planned DM data products related to {\tt DIASource} detectability.}


\setDocChangeRecord{%
\addtohist{0.0}{2018-11-01}{Internal working document.}{Melissa Graham}
\addtohist{0.1}{2019-09-09}{Updated to represent DM's plans.}{Melissa Graham}
\addtohist{1}{2022-04-dd}{Update and release.}{Melissa Graham}
}

\begin{document}

\maketitle

% CITATION EXAMPLES
% \verb|\citellp|: \citellp{LPM-17, LSE-30} \\
% \verb|\citell|: (SRD; \citell{LPM-17,LSE-29}) \\
% \verb|\citep[][]|: \citep[e.g.,][are interesting]{LPM-17,LSE-29} \\
% \verb|\cite|: \cite{LPM-17,LSE-29}
% \citeds{LSE-163}, \citedsp{LSE-163}


% % % % % % % % % % % % % % % % % %
\section{Introduction} \label{sec:intro}

Any astrophysical question which asks, e.g., {\it "How often?"} or {\it "How many?"} about transient phenomena, such as population studies or occurrence rates, needs to know a survey's {\it detection efficiency}: the probability that a source is detected (or in other words, the fraction of all sources that are detected).

Detection efficiencies are required for many of the core science pillars of the LSST, such as transient phenomena, cosmology, and Solar System studies; many other surveys use populations of synthetic sources injected into the data in order to characterize the detection efficiency (Appendix~\ref{sec:sci}).
This should be done for the LSST as well -- deriving detection efficiencies is too large and complicated a task to leave for the science community.

Rubin Observatory documentation contains no requirements related to producing or serving detection efficiencies for transient {\tt DIASources} in difference images (Appendix~\ref{sec:docs}), but does contain requirements about using source injection to characterize detected source {\it spuriousness} (see also Appendix~\ref{sec:rb}).

This document describes how Rubin Observatory should use its synthetic source injection algorithms to measure and provide detection efficiencies for transient point sources detected by the LSST via difference image analysis (DIA).

Readers should refer to the Data Products Definitions Document \citedsp{LSE-163} for more information about DIA, difference images, and {\tt DIASources}.
Detection efficiencies of extended difference-image sources (e.g., light echoes, trailed moving objects), or for variable or static point-sources in direct images, are beyond the scope of this document.


\section{Proposed Detection Efficiency Matrix}

{\bf Detection:} as described in the SRD and DPDD, sources in difference images with a signal-to-noise ratio $SNR > {transSNR} = 5$ will be considered {\it detected} and will become a {\tt DIASource}.
 
{\bf Detection Efficiency:} The probability that a true astrophysical source of a given magnitude is detected and becomes a {\tt DIASource}. In other words, the fraction of all true astrophysical sources of a given magnitude that are detected and become {\tt DIASources}. 

Characterizing detection efficiency requires {\it knowing} which of the detected {\tt DIAsources} are astrophysical, and the total number of astrophysical sources in the field of the image.
This would only be possible if ``truth" is somehow known from, e.g., co-temporal imaging data of superior quality -- but of course that almost never exists because it is inefficient to duplicate data.

Instead, the detection efficiency is typically characterized by simulating and injecting synthetic sources into images, using a point-spread function shape like real astrophysical sources, and then processing the images with the survey's difference image analysis pipeline and measuring the fraction recovered.

The detection efficiency can be characterized as $\eta(m)$, where $m$ is the apparent magnitude of the time-changing component with respect to the template image, and $\eta$ is a value between $0$ and $1$ that represents the probability that the source would be detected in the difference image.
As described in Appendix~\ref{sec:sci}, $\eta$ depends on more than just $m$, and is a function of the parameters ($\vv{P}$) listed in Table \ref{tab:eta_pars}.

An accurate measure of $\eta(m,\vv{P})$ for every pixel of every difference image is technologically unfeasible.
Instead, an analytic model for $\eta$ as a function of both $m$ and parameters $\vv{P}$ (some of which may be correlated) can be built with synthetic source injection, and then applied by users.

This means that the synthetic sources should be simulated over a range of parameters $\vv{P}$, but as described in Appendix~\ref{sec:sci} the simulated sources do not need to accurately represent astrophysical transient types, colors, redshifts, durations, light curves, etc.
That aspect of the analysis is best left to the user to handle during the MC simulation stage for their particular type of object.
 
\begin{table}[h]
\begin{center}
\begin{footnotesize}
\caption[]{A description of the image and source parameters ($\vv{P}$) that can affect the detection efficiency ($\eta$) of point sources in a difference image (per filter).}
\label{tab:eta_pars}
\setlength{\extrarowheight}{5pt}
\begin{tabular}{|p{3.1cm}|p{12cm}|}
\hline
{\bf Parameter} & {\bf Description} \\
\hline
%Apparent Magnitude & Typically, $\eta$ decreases for fainter objects (and brighter objects due to saturation). \\
%\hline
Surface Brightness & Typically, $\eta$ decreases for objects embedded in brighter host galaxies. \\
\hline
Static-Source Offset & Sometimes, $\eta$ decreases for objects that are near (i.e., overlap the point-spread function of) static sources (e.g., stars, galaxy cores, especially if cuspy in profile). \\
\hline
CCD Location & With some instruments, $\eta$ decreases near the CCD edges due to distortion. \\
\hline
Image FWHM & The value of $\eta$ can decrease for extreme FWHM differences from the template (i.e., very good or very poor seeing). \\
\hline
Image Airmass & LSST images will experience differential chromatic refraction which affects image subtraction \citedsp{DMTN-037}, and thus potentially also $\eta$. \\
\hline
Sky Brightness & Typically, $\eta$ decreases when the sky background is bright or has a strong gradient (e.g., during twilight, near the moon). \\
\hline
Sky Cloud Cover & Extinction will affect $\eta$ by degrading the image magnitude limit. \\
\hline
\end{tabular}
\end{footnotesize}
\end{center}
\end{table}


%\subsection{Study Overview}
%\begin{itemize}
%\item \S~\ref{sec:sci} contains a primer on the concepts related to detection efficiencies, and an overview of several science goals that rely on them, with examples of methods for generating and applying detection efficiencies from a selection of recent time-domain surveys. 
%\item \S~\ref{sec:docs} reviews the LSST Data Management System's (DMS) literature and highlights existing plans, policies, requirements, and specifications related to the generation of LSST survey detection efficiencies. 
%\item \S~\ref{sec:opts} presents and evaluates various options for how the DMS could provide detection efficiencies as a data product. 
%\item \S~\ref{sec:tech} outlines several techniques for injecting fake point source variability into images.
%\end{itemize}

%\subsection{Summary of Study Findings}
%\begin{enumerate}
%\item It would enable some science -- and require no increase in scope -- to make available (e.g., as part of the annual DR) the data for the simulated point sources that will be used to characterize the {\tt DIASouce} spuriousness parameter in order to meet requirements in \citedsp{LSE-61}. This will enable users to build detection efficiency matrices, $\eta(\vv{P})$, for their science goals.
%\item It would enable more science -- and require only a small increase in scope -- to ensure that the fake point sources cover the parameter space needed for scientific analyses involving detection efficiencies, which may be different from that of internal uses. 
%\item It would be more scientifically useful -- again with another small increase in scope -- to calculate and provide the detection efficiency matrix itself, $\eta(\vv{P})$, as a data product (e.g., in the annual DR).
%\item Further study (simulations) will be needed to identify the full set of parameters $\vv{P}$ for which $\eta$ should be determined, and optimal mode of fake injection (e.g., modeling the point spread function or using isolated stars).
%\item Soliciting feedback and science use-cases from the community should be considered as a means to prioritize and make decisions regarding the above.
%\end{enumerate}

%See also \S~\ref{sec:future}.


\clearpage
\bibliography{local,lsst,refs,books,refs_ads}

% % % % % % % % % % % % % % % % % %
\clearpage
\appendix

\input{ap_sci.tex}

\input{ap_docs.tex}

\input{ap_rb.tex}

\input{ap_opts.tex}

\input{ap_tech.tex}

\end{document}

